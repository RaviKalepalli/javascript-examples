'use strict';
const splitOnOrigin = require('./splitOnOrigin');

function makeGetResourceUrlsAndBlobs({processResource, aggregateResourceUrlsAndBlobs}) {
  return function getResourceUrlsAndBlobs(doc, baseUrl, absoluteUrls) {
    const {externalUrls, internalUrls} = splitOnOrigin(absoluteUrls, baseUrl);
    return Promise.all(
      internalUrls.map(url =>
        processResource(url, doc, getResourceUrlsAndBlobs.bind(null, doc, baseUrl)),
      ),
    ).then(resourceUrlsAndBlobsArr =>
      aggregateResourceUrlsAndBlobs(resourceUrlsAndBlobsArr, {
        resourceUrls: externalUrls,
        blobsObj: {},
      }),
    );
  };
}

module.exports = makeGetResourceUrlsAndBlobs;
